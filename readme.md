# EmailPusher

## Зависимости
Надо иметь установленные python>=3.6 и pip к нему.  
В командной строке вводим:
```shell
pip3 install aiohttp asyncpg python-dateutil pyyaml
```

## Начало работы
### Конфигурационный файл
Копируем (или переименовываем) файл config-sample.yml в config.yml и прописываем в нём данные от Postgres базы данных, а также ключ api и нужный список в Unisender.
### Запуск основного сервиса
Просто вводим в консоли...
```shell
python3 mainservice.py
```
...и готово, сервис висит на порту 8080.  
Можно запускать вместе с системой, но как – тут не описано :)
### Запуск сервиса по добавлению неподготовленных данных в очередь на отправку
В консоли вводим...
```shell
python3 additionaldata.py
```
...и готово, в очередь на завтра добавлены свежайшие записи с мейлрушными почтами в количестве максимум трети от уже запланированных на завтра отправок.  
Лучше всего запускать где-то в 23:10, чтобы сервис успел отработать, а база была достаточно свежей.
### Остановка сервисов
PID процессов записывается в файл *.pid, по нему можно убивать процесс

## Запросы к основному сервису
Все запросы совершаются GET-методом
### Добавить запись в очередь на отправку
Путь: **/add_entry**  
Параметры:  
*email* - email для внесения в список  
*name* (необязательно) - имя для внесения в список в текстовом формате  
*phone* (необязательно) - телефон для внесения в числовом формате (11 цифр)  
*list* - список Unisender в который надо отправлять данные  
*time* - время внесения в список в формате YYYY-MM-DD HH:MM:SS  
### Очистить день от очереди
Путь: **/remove_day**  
Параметры:  
*day* - день для очистки в формате YYYY-MM-DD  
### Добавить необрабработанные данные
Путь: **/add_raw_data**  
Параметры:  
*name* - имя для внесения в список в текстовом формате.  
*email* - email для внесения в список  
*phone* - телефон для внесения в числовом формате (11 цифр)  